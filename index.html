<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ESP32 雲端溫溼度</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>

<body>
<h1>ESP32 AHT20 即時溫溼度</h1>

<div id="data">等待資料中...</div>
<a href="/sensor.html">查看溫溼度</a>
    
    <h2>GPIO 控制</h2>
    <button onclick="gpio(2,1)">GPIO2 ON</button>
    <button onclick="gpio(2,0)">GPIO2 OFF</button>

<script>

// HiveMQ WebSocket 連線
const client = mqtt.connect("wss://b04357396fdc4b2f976f3ea149c6c19c.s1.eu.hivemq.cloud:8884/mqtt", {
    username: "esp32c3sm01",
    password: "aHt20262"
});

client.on("connect", function () {
    console.log("MQTT 已連線");
    client.subscribe("esp32/aht20");
});

client.on("message", function (topic, message) {
    const data = JSON.parse(message.toString());

    document.getElementById("data").innerHTML =
        "溫度: " + data.temp + " °C<br>" +
        "濕度: " + data.hum + " %";
});

    function gpio(pin,state){
        const msg = JSON.stringify({pin:pin,state:state});
        client.publish("esp32/gpio/control", msg);
    }    
</script>
</body>
</html>
